(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{1564:function(e,t,a){"use strict";a.r(t);var n=a(164),r=a.n(n),l=a(165),i=a.n(l),c=a(125),u=a.n(c),o=a(166),s=a.n(o),p=a(167),m=a.n(p),d=a(124),b=a.n(d),f=a(16),h=a.n(f),v=a(4),g=a.n(v),S=a(954),_=a(961),y=a.n(_),F=a(126),E=a(11),T=a(947),O=a(1256),w=a(1239),k=a(1240),D=a(1241),A=a(1),j=a(1242),I=a(19),N=a(951),C=a(946),x=a.n(C);function L(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function P(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?L(Object(a),!0).forEach((function(t){h()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):L(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function R(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=b()(e);if(t){var r=b()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return m()(this,a)}}var z="",V=!1,B=!1,H=function(e){s()(a,e);var t=R(a);function a(e){var n;return r()(this,a),n=t.call(this,e),h()(u()(n),"getTemplateItem",(function(e){var t=n.state.template;t.push({type:e.toLowerCase(),attribute_name:"",attribute_dropdown:"",include_in_thumbnail:""}),n.setState({template:t,addFlag:!1})})),h()(u()(n),"addFlag",(function(){n.setState({addFlag:!n.state.addFlag})})),h()(u()(n),"successPopup",(function(){n.setState({addFlag:!1,successFlag:!0,SuccessPopupFlag:!0})})),h()(u()(n),"successPopupClosePopup",(function(){n.props.templateInitialization(),n.setState({addFlag:!1,SuccessPopupFlag:!1})})),h()(u()(n),"formateTemplateData",(function(e){var t=n.props.templateObj.templateDetailsInfo,a=t._id,r=t.acceptance_form,l=n.state.autoSaveFlag,i=e.attribute,c=e.template_name,u=e.template_type,o=e.isAcceptanceDocument,s=e.thumbnail,p={};i&&i.length>0&&(p=i.map((function(e,t){return P(P({},e),{},{order:t+1})})).reduce((function(e,t){return e[t.type]=e[t.type]||[],"attribute"===t.type&&("Text"===t.attribute_dropdown?e[t.type].push({order:t.order,attribute_name:t.attribute_name,dataType:t.attribute_dropdown,include_in_thumbnail:t.include_in_thumbnail,value:t.description}):"Image"===t.attribute_dropdown||"Qr"===t.attribute_dropdown?e[t.type].push({order:t.order,attribute_name:t.attribute_name,dataType:t.attribute_dropdown,default:t.include_in_thumbnail}):e[t.type].push({order:t.order,attribute_name:t.attribute_name,dataType:t.attribute_dropdown,include_in_thumbnail:t.include_in_thumbnail})),e}),Object.create(null)));return!("attribute"in p)&&(p.attribute=[]),p.autoSave=l||!1,p.template_name=c||"",p.template_type=u||"",p.isAcceptanceDocument=o||!1,p.templateId=a,p.thumbnail=s,!0===p.isAcceptanceDocument&&""!==r&&(p.acceptance_form=r||""),p})),h()(u()(n),"handleSubmit",(function(e){var t=n.state,a=t.autoSaveFlagCheck,r=t.autoSaveFlag,l=e.attribute,i=n.props.templateObj.templateDetailsInfo,c=(i._id,i.acceptance_form),u={};if(0===l.length)E.c.error("At least one attribute is required"),n.setState({autoSaveFlag:!r});else{if(u=n.formateTemplateData(e),!0===a){if(!0!==u.isAcceptanceDocument||c){B=!0;var o=Object(N.a)(u);n.props.autoSaveTemplate(o)}else E.c.error("Acceptance tik is required"),n.setState({autoSaveFlag:!r});n.setState({autoSaveFlagCheck:!1})}else if(!0===u.isAcceptanceDocument)n.props.history.push("/selectAcceptanceTemp",{finalObj:u,editFlag:!1});else{var s=Object(N.a)(u);n.props.editTemplate(s)}B=!1}})),h()(u()(n),"handleTabAttribute",(function(e){"recent"===e?n.setState({recentAttributeFlag:!0}):n.setState({recentAttributeFlag:!1})})),h()(u()(n),"inilitizeTempValue",(function(e){var t=e.attribute,a=e.image,n=e.text,r=[];if(null!==e){var l=y.a.unionBy(a,n,t),i=y.a.orderBy(l,["_id"],["asc"]);null!==e&&i.length>0&&i.map((function(e){var t="";t=e.image_title?"image":e.attribute_name?"attribute":"text",r.push({type:t,attribute_name:e.attribute_name||e.image_title||e.title||"",attribute_dropdown:e.dataType||"",include_in_thumbnail:("Image"===e.dataType||"Qr"===e.dataType?e.default:e.include_in_thumbnail)||!1,description:e.value||""})}))}return r})),h()(u()(n),"handleCheckboxAutoSave",(function(e){n.setState({autoSaveFlag:e.target.checked,autoSaveFlagCheck:!0,autoSaveLoader:!0},(function(){n.buttonRef.current.click()}))})),h()(u()(n),"getFormData",(function(e){var t=n.formateTemplateData(e),a=Object(N.a)(t);n.props.autoSaveTemplate(a)})),n.state={flag:!1,selectTemplate:["Attribute","Thumbnail","Text"],addFlag:!1,recentAttributeFlag:!0,attribute:[],successFlag:!0,SuccessPopupFlag:!0,autoSaveFlag:e.templateObj&&e.templateObj.templateDetailsInfo&&e.templateObj.templateDetailsInfo.autoSave,autoSaveData:"",formData:"",checkDetailsLoader:!1,templateId:"",autoSaveFlagCheck:!1,autoSaveLoader:!1},n.wrapperRef=g.a.createRef(),n.handleClickOutside=n.handleClickOutside.bind(u()(n)),n.buttonRef=g.a.createRef(),n.getFormData=n.getFormData.bind(u()(n)),n}return i()(a,[{key:"handleClickOutside",value:function(e){this.wrapperRef&&!this.wrapperRef.current.contains(e.target)&&this.setState({addFlag:!1})}},{key:"componentDidUpdate",value:function(e,t){var a=this,n=this.props.templateObj,r=n.templateUpdate,l=n.templateDetailsInfo,i=n.autoSaveSuccess,c=this.state,u=c.templateId,o=c.autoSaveFlag;this.props!==t&&(!0===r&&this.props.history.push("template"),""!==n&&null!==l&&(!0===l.autoSave&&!1===V?(z=setInterval((function(){a.setState({autoSaveFlagCheck:!0},(function(){a.buttonRef.current.click()}))}),6e4),V=!0):!1!==l.autoSave&&void 0!==l.autoSave||!0!==V||(clearInterval(z),V=!1,this.setState({autoSaveFlagCheck:!1}))),!0===i&&(this.props.detailsTemplateListInfo(u),this.props.getTemplateListInfo({search:""}),this.props.templateInitialization())),this.props.error&&(this.setState({autoSaveFlag:!o}),this.props.errorClear())}},{key:"componentWillUnmount",value:function(){clearInterval(z),V=!1,this.setState({autoSaveFlag:!1}),this.props.templateInitialization(),document.removeEventListener("mousedown",this.handleClickOutside)}},{key:"componentDidMount",value:function(){var e=this;if(document.addEventListener("mousedown",this.handleClickOutside),this.props.location.state&&this.props.location.state.data){var t=this.props.location.state.data._id;this.setState({templateId:t},(function(){e.props.detailsTemplateListInfo(t)}))}else{var a=this.props.location.state.finalObj.templateId;this.setState({templateId:a},(function(){e.props.detailsTemplateListInfo(a)}))}this.setState({checkDetailsLoader:!0}),this.props.recentAttributeListInfo(),this.props.errorClear();var n=this.props.templateObj.templateDetailsInfo;null!==n&&this.setState({autoSaveFlag:n.autoSave})}},{key:"render",value:function(){var e=this,t=this.state,a=t.recentAttributeFlag,n=t.SuccessPopupFlag,r=t.checkDetailsLoader,l=t.autoSaveFlag,i=(t.autoSaveLoader,this.props),c=i.templateObj,u=i.location.state,o=c.recentAttribute,s=c.recentAttributeLoader,p=c.successPopup,m=c.templateDetailsInfo,d=c.detailsLoader,b=c.successLoader,f=(c.autoSaveSuccess,c.autoSaveData),h={};if(u&&u.finalObj&&1==u.selectTemp){var v,_=u.finalObj,y=_.isAcceptanceDocument,F=_.template_name,E=_.template_type,A=_.thumbnail;v=this.inilitizeTempValue(u.finalObj),h.template_name=F,h.template_type=E,h.isAcceptanceDocument=y||!1,h.thumbnail=A||"",h.attribute=v}else if(null!==m){var N,C=m.isAcceptanceDocument,L=m.template_name,P=m.template_type,R=m.thumbnail;N=this.inilitizeTempValue(m),h.template_name=L,h.template_type=P,h.isAcceptanceDocument=C||!1,h.thumbnail=R||"",h.attribute=N}var z="";return(null!==f||null!==m&&m.autoSave)&&(z=null===f?x()(m.createdAt).fromNow():x()(f.createdAt).fromNow()),g.a.createElement(T.w,null,g.a.createElement("div",{id:"createTemp",className:"wrapper wrapper-content createTemp"},g.a.createElement("div",{className:"row"},g.a.createElement("div",{className:"col-xl-12"},g.a.createElement("div",{className:"containerBox p-0"},g.a.createElement("div",{className:"row"},g.a.createElement(S.d,{enableReinitialize:null!==m,initialValues:h,validationSchema:k.a,onSubmit:this.handleSubmit,render:function(t){var n=t.values,i=t.errors,c=t.touched,u=t.handleSubmit,p=t.setFieldValue,h=t.setFieldTouched;t.resetForm;return g.a.createElement(g.a.Fragment,null,g.a.createElement(S.b,{name:"attribute",render:function(t){return g.a.createElement(g.a.Fragment,null,g.a.createElement("div",{id:"createTemplateleft",className:"col-xl-9 col-lg-8 col-sm-12 border-right py-4 pl-5"},g.a.createElement("div",{className:"table-title d-flex justify-content-between align-items-center mb-4"},g.a.createElement("ul",{className:"ks-cboxtags"},g.a.createElement("li",null,B&&g.a.createElement("i",{className:"fa fa-refresh fa-spin"})||g.a.createElement(g.a.Fragment,null,g.a.createElement("input",{type:"checkbox",id:"checkboxOne",value:"",onChange:function(t){return e.handleCheckboxAutoSave(t)},checked:null===l?null!==m&&m.autoSave:l}),g.a.createElement("label",{htmlFor:"checkboxOne"},"Auto Save"))),(null!==f||null!==m&&m.autoSave)&&g.a.createElement("li",null,g.a.createElement("span",null,"Last saved ",z))),g.a.createElement("h2",{className:"f-b m-0"},"Edit Template "),g.a.createElement("button",{type:"submit",onClick:u,className:"btn-primary p-2 next mr-15 templateButton",disabled:b,ref:e.buttonRef},b?g.a.createElement("i",{className:"fa fa-refresh fa-spin"}):0==n.isAcceptanceDocument?"Submit":"Next")),d&&!1===r&&g.a.createElement(I.a,null)||g.a.createElement("div",{className:"fixHeight",style:{minHeight:"calc(100vh - 280px)",position:"relative"}},g.a.createElement(S.c,null,g.a.createElement("ul",{className:"slides"},g.a.createElement(w.a,{setFieldTouched:h,values:n,errors:i,touched:c,setFieldValue:p}),g.a.createElement("div",null,g.a.createElement(O.a,{data:n.attribute,setFieldTouched:h,values:n,errors:i,touched:c,setFieldValue:p,arrayHelpers:t}))))),g.a.createElement("div",{className:"dropup puls-drop show",ref:e.wrapperRef},g.a.createElement("a",{className:"btn plus-btn f-24 text-center p-2",onClick:function(){t.push({type:"attribute",attribute_name:"",attribute_dropdown:"",include_in_thumbnail:!1,description:""}),e.setState({addFlag:!1})}}," ",g.a.createElement("i",{className:"fas fa-plus"})))),g.a.createElement("div",{id:"editTemplateright",className:"col-xl-3 col-lg-4 col-sm-12"},g.a.createElement("ul",{className:"nav nav-pills my-3 flex-wrap justify-content-center",role:"tablist"},g.a.createElement("li",{className:"nav-item"},g.a.createElement("a",{className:"nav-link  ".concat(!0===a?"active":""),"data-toggle":"pill",role:"tab",onClick:function(){return e.handleTabAttribute("recent")}},"Recent Attributes")),g.a.createElement("li",{className:"nav-item"},g.a.createElement("a",{className:"nav-link  ".concat(!0===a?"":"active"),"data-toggle":"pill",role:"tab",onClick:function(){return e.handleTabAttribute("live")}},"Live Preview"))),g.a.createElement("div",{className:" recent-attribute-main-container"},g.a.createElement("div",null,g.a.createElement("div",{className:"tab-content pr-3 br-6 mr-2",style:{maxHeight:"calc(100vh - 320px)",overflowY:"auto"}},!0===a?g.a.createElement(D.a,{recentAttribute:a,recentAttributeLoader:s,attribute:o.length>0?o:[],addRecentAttribute:function(e){var a={type:"attribute",attribute_name:e.attribute_name||e.image_title||e.title,attribute_dropdown:e.dataType,include_in_thumbnail:e.include_in_thumbnail,description:e.description};t.push(a)}}):g.a.createElement(j.a,{attribute:n.attribute}))))))}}))}})))))),!0===n&&p?g.a.createElement(T.q,{msg:p.msg,closePopup:this.successPopupClosePopup,history:this.props.history}):null)}}]),a}(v.Component);t.default=Object(F.b)((function(e){return{templateObj:e.Template,error:e.Auth.error}}),(function(e){return{recentAttributeListInfo:function(){return e(A.Jc())},createTemplate:function(t){return e(A.L(t))},detailsTemplateListInfo:function(t){return e(A.pb(t))},editTemplate:function(t){return e(A.Bb(t))},autoSaveTemplate:function(t){return e(A.D(t))},templateInitialization:function(){return e(A.fd())},errorClear:function(){return e(A.Fb())},getTemplateListInfo:function(t){return e(A.ac(t))}}}))(H)}}]);